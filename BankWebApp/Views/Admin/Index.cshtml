@model BankWebApp.Models.AdminDashboardViewModel
@{
    ViewData["Title"] = "Admin Dashboard";
}

<h1>Admin dashboard</h1>
<p>This page calls the BankWebService API and lists user profiles, accounts, and transactions.</p>

<div class="table-responsive">
    <h2>Users</h2>
    <table class="table table-striped" id="usersTable">
        <thead>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Address</th>
                <th>Phone</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var u in Model.Users)
        {
            <tr>
                <td>@u.Username</td>
                <td>@u.Email</td>
                <td>@u.Address</td>
                <td>@u.Phone</td>
            </tr>
        }
        </tbody>
    </table>
</div>

<div class="table-responsive">
    <h2>Accounts</h2>
    <table class="table table-striped" id="accountsTable">
        <thead>
            <tr>
                <th>Account #</th>
                <th>Username</th>
                <th>Email</th>
                <th class="text-end">Balance</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var a in Model.Accounts.OrderBy(x => x.AccountNumber))
        {
            <tr>
                <td>@a.AccountNumber</td>
                <td>@a.Username</td>
                <td>@a.Email</td>
                <td class="text-end">@a.Balance</td>
            </tr>
        }
        </tbody>
    </table>
</div>

<div class="table-responsive">
    <h2>Transactions</h2>
    <select id="txTypeFilter" class="form-select form-select-sm w-auto mb-2">
        <option value="">All</option>
        <option value="Deposit">Deposit</option>
        <option value="Withdraw">Withdraw</option>
    </select>
    <table class="table table-bordered" id="transactionsTable">
        <thead>
            <tr>
                <th>Id</th>
                <th>Account #</th>
                <th>Type</th>
                <th>Amount</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var t in Model.Transactions.OrderByDescending(x => x.TransactionId))
        {
            <tr>
                <td>@t.TransactionId</td>
                <td>@t.AccountNumber</td>
                <td>@t.Type</td>
                <td>@t.Amount</td>
            </tr>
        }
        </tbody>
    </table>
</div>

@section Scripts {
<script>
  $(function () {
    // Users
    $('#usersTable').DataTable({
      pageLength: 10,
      order: [],
      columns: [null, null, null, null]
    });

    // Accounts
    $('#accountsTable').DataTable({
      pageLength: 10,
      order: [[0, 'asc']],
      columnDefs: [
        { targets: 0, type: 'num' },
        { targets: 3, render: $.fn.dataTable.render.number(',', '.', 2) }
      ]
    });

    // Transactions
    const txTable = $('#transactionsTable').DataTable({
      pageLength: 25,
      order: [[0, 'desc']],
      columnDefs: [
        { targets: [0, 1], type: 'num' },
        { targets: 3, render: $.fn.dataTable.render.number(',', '.', 2) }
      ]
    });

    // Filter by Type (column index 2)
    $('#txTypeFilter').on('change', function () {
      txTable.column(2).search(this.value).draw();
    });
  });
</script>
}
